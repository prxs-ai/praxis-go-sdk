@startuml
!theme plain

participant "Client" as C
participant "Agent 1\nHTTP API" as A1
participant "DSL\nAnalyzer" as DSL
participant "Agent 1\nCore" as Core1
participant "P2P\nProtocol" as P2P1
participant "P2P\nNetwork" as Net
participant "Agent 2\nP2P" as P2P2
participant "Agent 2\nMCP Bridge" as Bridge
participant "MCP\nServer" as MCP
participant "Filesystem\nTool" as FS

C -> A1: POST /execute\n{"dsl": "CALL write_file..."}
A1 -> DSL: Parse DSL
DSL -> Core1: executeCall("write_file", args)
Core1 -> Core1: HasLocalTool("write_file")\n[returns false]
Core1 -> Core1: FindAgentWithTool("write_file")
Core1 -> P2P1: InvokeTool(peerID, "write_file", args)
P2P1 -> Net: Tool Request Stream
Net -> P2P2: Tool Request Stream
P2P2 -> Bridge: ProcessMCPRequest()
Bridge -> MCP: FindToolHandler("write_file")
MCP -> FS: WriteFileHandler(args)
FS -> FS: os.WriteFile()
FS --> MCP: Success
MCP --> Bridge: Result
Bridge --> P2P2: Response
P2P2 --> Net: Tool Response
Net --> P2P1: Tool Response
P2P1 --> Core1: Result
Core1 --> DSL: Result
DSL --> A1: Result
A1 --> C: JSON Response

@enduml